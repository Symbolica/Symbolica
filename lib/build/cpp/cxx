#!/usr/bin/env sh
set -e

# There is something more mysterious going on here wrt crt* objects
# The compiler seems to be finding the ones in sysroot/lib and adding them
# to the linker. So will it also find crtbegin from compiler-rt if we tell it to
# look there, or would we need to rebuild clang with USE_COMPILER_RT enabled?
CLANG=clang++ \
CRT_BEGIN_XLINKER="-Xlinker /home/me/.symbolica/build/sysroot/lib/linux/clang_rt.crtbegin-x86_64.o" \
XLINKER="$XLINKER -Xlinker -lc++" \
CRT_END_XLINKER="-Xlinker /home/me/.symbolica/build/sysroot/lib/linux/clang_rt.crtend-x86_64.o" \
exec /home/me/.symbolica/build/cc \
    -nostdinc++ \
    -I /home/me/.symbolica/build/sysroot/include/c++/v1 \
    -fno-exceptions \
    "$@"
