#!/usr/bin/env sh
set -e

p="$@"
set --

xlinker="$XLINKER"
extension=

for x in $p
do
    case "$x" in
        -o) set -- "$@" -o ; extension=".bc" ;;
        -c) xlinker= ; set -- "$@" "$x$extension" ; extension= ;;
        *) set -- "$@" "$x$extension" ; extension= ;;
    esac
done

if [ -z "$NO_LLVM" ];
    then clang-12 -emit-llvm -c "$@";
fi

if [ -n "$CODEGEN" ];
    then exec clang-12 $p $xlinker;
fi
