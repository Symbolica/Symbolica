#!/bin/bash
set -e

p="$@"
set --

xlinker="$XLINKER"
extension=

for x in $p
do
    case "$x" in
        -o) set -- "$@" -o ; extension=".bc" ;;
        -c) xlinker= ;&
        *) set -- "$@" "$x$extension" ; extension= ;;
    esac
done

if [ -z "$NO_LLVM" ];
    then clang-8 -emit-llvm -c "$@";
fi

if [ -n "$CODEGEN" ];
    then exec clang-8 $p $xlinker;
fi
