#!/usr/bin/env sh
set -e

p="$@"
set --

CLANG=${CLANG:='clang-12'}
crtBeginXlinker="$CRT_BEGIN_XLINKER"
crtEndXlinker="$CRT_END_XLINKER"
xlinker="$XLINKER"
extension=

for x in $p
do
    case "$x" in
        -o) set -- "$@" -o ; extension=".bc" ;;
        -c) set -- "$@" -c ; xlinker= ; crtBeginXlinker= ; crtEndXlinker= ;;
        *) set -- "$@" "$x$extension" ; extension= ;;
    esac
done

if [ -z "$NO_LLVM" ];
    then ${CLANG} -emit-llvm -c "$@";
fi

if [ -n "$CODEGEN" ];
    then exec ${CLANG} $crtBeginXlinker $p $xlinker $crtEndXlinker;
fi
