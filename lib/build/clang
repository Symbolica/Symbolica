#!/usr/bin/env sh
set -e

p="$@"
set --

CLANG=${CLANG:='clang-12'}
xlinker="$XLINKER"
extension=

for x in $p
do
    case "$x" in
        -o) set -- "$@" -o ; extension=".bc" ;;
        -c) set -- "$@" -c ; xlinker= ;;
        *) set -- "$@" "$x$extension" ; extension= ;;
    esac
done

if [ -z "$NO_LLVM" ];
    then ${CLANG} -emit-llvm -c "$@";
fi

if [ -n "$CODEGEN" ];
    then exec ${CLANG} $p $xlinker;
fi
